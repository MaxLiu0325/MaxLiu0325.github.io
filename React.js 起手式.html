<!doctype html>
<html><head><title>React.js 起手式</title><meta charset="UTF-8"><link href="http://fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700,700italic|Roboto:400,700,700italic,400italic" rel="stylesheet" type="text/css"><style>/*
 * Copyright 2014 Quip
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations
 * under the License.
 */

body {
    font-size: 15px;
    color: #333;
    background: white;
    padding: 60px 95px;
    max-width: 900px;
    margin: 0 auto;
    text-rendering: optimizeLegibility;
    font-feature-settings: "kern";
    font-kerning: normal;
    -moz-font-feature-settings: "kern";
    -webkit-font-feature-settings: "kern";
}

/* Headings */
h1,
h2,
h3,
th {
    font-family: Roboto, sans-serif;
    font-weight: 700;
    margin: 0;
    margin-top: 1.25em;
    margin-bottom: 0.75em;
}

h1 {
    font-size: 35px;
    line-height: 42px;
}

h1:first-child {
    margin-top: 0;
}

h2 {
    font-size: 18px;
    line-height: 22px;
}

h3 {
    font-size: 13px;
    line-height: 16px;
}

.capitalize-h3 h3 {
    text-transform: uppercase;
}

/* Body text */
body,
p,
ul,
ol,
td {
    font-family: "Crimson Text", serif;
    font-size: 16px;
    line-height: 20px;
}

blockquote,
q {
    display: block;
    margin: 1em 0;
    font-style: italic;
}

blockquote a,
q a {
    text-decoration: underline;
}

blockquote {
    padding-left: 10px;
    border-left: 4px solid #a6a6a6;
}

q {
    color: #a6a6a6;
    line-height: 40px;
    font-size: 24px;
    text-align: center;
    quotes: none;
}

q a {
    color: #a6a6a6;
}

code,
pre {
    font-family: Consolas, "Liberation Mono", Menlo, "Courier Prime Web",
        Courier, monospace;
    background: #f2f2f2;
}

code {
    padding: 1px;
    margin: 0 -1px;
    border-radius: 3px;
}

pre {
    display: block;
    line-height: 20px;
    text-shadow: 0 1px white;
    padding: 5px 5px 5px 30px;
    white-space: nowrap;
    position: relative;
    margin: 1em 0;
}

pre:before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 15px;
    border-left: solid 1px #dadada;
}

/* Lists */
div[data-section-style="5"],
div[data-section-style="6"],
div[data-section-style="7"] {
    margin: 12px 0;
}

ul {
    padding: 0 0 0 40px;
}

ul li {
    margin-bottom: 0.4em;
}

/* Bulleted list */
div[data-section-style="5"] ul {
    list-style-type: disc;
}
div[data-section-style="5"] ul ul {
    list-style-type: circle;
}
div[data-section-style="5"] ul ul ul {
    list-style-type: square;
}
div[data-section-style="5"] ul ul ul ul {
    list-style-type: disc;
}
div[data-section-style="5"] ul ul ul ul ul {
    list-style-type: circle;
}
div[data-section-style="5"] ul ul ul ul ul ul {
    list-style-type: square;
}

/* Numbered list */
div[data-section-style="6"] ul {
    list-style-type: decimal;
}
div[data-section-style="6"] ul ul {
    list-style-type: lower-alpha;
}
div[data-section-style="6"] ul ul ul {
    list-style-type: lower-roman;
}
div[data-section-style="6"] ul ul ul ul {
    list-style-type: decimal;
}
div[data-section-style="6"] ul ul ul ul ul {
    list-style-type: lower-alpha;
}
div[data-section-style="6"] ul ul ul ul ul ul {
    list-style-type: lower-roman;
}

/* Checklist */
div[data-section-style="7"] ul {
    list-style-type: none;
}

div[data-section-style="7"] ul li:before {
    content: "\2610";
    position: absolute;
    display: inline;
    margin-right: 1.2em;
    margin-left: -1.2em;
}

div[data-section-style="7"] ul li.parent:before {
    content: "";
}

div[data-section-style="7"] ul li.checked {
    text-decoration: line-through;
}

div[data-section-style="7"] ul li.checked:before {
    content: "\2611";
    text-decoration: none;
}

/* Tables */
div[data-section-style="8"] {
    margin: 12px 0;
}

table {
    border-spacing: 0;
    border-collapse: separate;
    border: solid 1px #bbb;
    table-layout: fixed;
    position: relative;
}

table th,
table td {
    padding: 2px 2px 0;
    min-width: 1.5em;
    word-wrap: break-word;
}

table th {
    border-bottom: 1px solid #c7cbd1;
    background: #f2f2f2;
    font-weight: bold;
    vertical-align: bottom;
    color: #3a4449;
    text-align: center;
}

table td {
    padding-top: 0;
    border-left: 1px solid #c7cbd1;
    border-top: 1px solid #c7cbd1;
    vertical-align: top;
}

table td.bold {
    font-weight: bold;
}

table td.italic {
    font-style: italic;
}

table td.underline {
    text-decoration: underline;
}

table td.strikethrough {
    text-decoration: line-through;
}

table td.underline.strikethrough {
    text-decoration: underline line-through;
}

table td:first-child {
    border-left: hidden;
}

table tr:first-child td {
    border-top: hidden;
}

/* Images */
div[data-section-style="11"] {
    margin-top: 20px;
    margin-bottom: 20px;
    margin-left: auto;
    margin-right: auto;
}

div[data-section-style="11"][data-section-float="0"] {
    clear: both;
    text-align: center;
}

div[data-section-style="11"][data-section-float="1"] {
    float: left;
    clear: left;
    margin-right: 20px;
}

div[data-section-style="11"][data-section-float="2"] {
    float: right;
    clear: right;
    margin-left: 20px;
}

div[data-section-style="11"] img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: auto;
}

hr {
    width: 70px;
    margin: 20px auto;
}

/* Apps */
div[data-section-style="19"].placeholder {
    margin: 0.8em auto;
    padding: 4px 0;
    display: block;
    color: #3d87f5;
    text-align: center;
    border: 1px solid rgba(41, 182, 242, 0.2);
    border-radius: 3px;
    background: #e9f8fe;
    font-family: Roboto, sans-serif;
}

div[data-section-style="19"].first-party-element {
    margin-bottom: 10px;
    background-repeat: no-repeat;
    background-size: contain;
}

div[data-section-style="19"].first-party-element.kanban {
    background-image: url("https://quip-cdn.com/nK0hSyhsb4jrLIL2s5Ma-g");
    height: 166px;
}

div[data-section-style="19"].first-party-element.calendar {
    background-image: url("https://quip-cdn.com/OYujqLny03RILxcLIiyERg");
    height: 244px;
}

div[data-section-style="19"].first-party-element.poll {
    background-image: url("https://quip-cdn.com/fbIiFrcKGv__4NB7CBfxoA");
    height: 116px;
}

div[data-section-style="19"].first-party-element.countdown {
    background-image: url("https://quip-cdn.com/3bPhykD2dBei9sSjCWteTQ");
    height: 96px;
}

div[data-section-style="19"].first-party-element.process_bar {
    background-image: url("https://quip-cdn.com/ybQlHnHEIIBLog5rZmYs_w");
    height: 36px;
}

div[data-section-style="19"].first-party-element.project_tracker {
    background-image: url("https://quip-cdn.com/OFQU087b4Mxzz1ZaHwtjXA");
    height: 164px;
}

div[data-section-style="19"] img {
    margin: 0.5em;
}

div[data-section-style="19"] img.masked-image {
    margin: 0;
    transform-origin: top left;
}

div[data-section-style="19"] .image-mask {
    position: relative;
    overflow: hidden;
}
/*
 * Copyright 2019 Quip
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations
 * under the License.
 */

body {
    counter-reset: indent0 indent1 indent2 indent3 indent4 indent5 indent6
        indent7 indent8;
}

/* Numbered list */
div[data-section-style="6"] {
    counter-reset: indent0 indent1 indent2 indent3 indent4 indent5 indent6
        indent7 indent8;
}
div[data-section-style="6"].list-numbering-continue {
    counter-reset: none;
}
div[data-section-style="6"].list-numbering-restart-at {
    counter-reset: indent0 var(--indent0) indent1 indent2 indent3 indent4
        indent5 indent6 indent7 indent8;
}
div[data-section-style="6"] ul {
    /* indent0 is not reset since it is shared across the div elements */
    list-style-type: none !important;
}
div[data-section-style="6"] ul ul {
    counter-reset: indent1;
}
div[data-section-style="6"] ul ul ul {
    counter-reset: indent2;
}
div[data-section-style="6"] ul ul ul ul {
    counter-reset: indent3;
}
div[data-section-style="6"] ul ul ul ul ul {
    counter-reset: indent4;
}
div[data-section-style="6"] ul ul ul ul ul ul {
    counter-reset: indent5;
}
div[data-section-style="6"] ul li {
    counter-increment: indent0;
}
div[data-section-style="6"] ul ul li {
    counter-increment: indent1;
}
div[data-section-style="6"] ul ul ul li {
    counter-increment: indent2;
}
div[data-section-style="6"] ul ul ul ul li {
    counter-increment: indent3;
}
div[data-section-style="6"] ul ul ul ul ul li {
    counter-increment: indent4;
}
div[data-section-style="6"] ul ul ul ul ul ul li {
    counter-increment: indent5;
}
div[data-section-style="6"] ul li:before {
    content: counter(indent0, decimal) ". ";
}
div[data-section-style="6"] ul ul li:before {
    content: counter(indent1, lower-alpha) ". ";
}
div[data-section-style="6"] ul ul ul li:before {
    content: counter(indent2, lower-roman) ". ";
}
div[data-section-style="6"] ul ul ul ul li:before {
    content: counter(indent3, decimal) ". ";
}
div[data-section-style="6"] ul ul ul ul ul li:before {
    content: counter(indent4, lower-alpha) ". ";
}
div[data-section-style="6"] ul ul ul ul ul ul li:before {
    content: counter(indent5, lower-roman) ". ";
}
</style></head><body><h1 id='OQYACA6xmA0'>React.js 起手式</h1>

<pre id='OQYACAOvQaV'><code>npx create</code><code>-</code><code>react</code><code>-</code><code>app </code><code>my</code><code>-</code><code>app<br>cd my-app<br>yarn start</code></pre>

<h2 id='OQYACAYJ36W'>Babel</h2>

<pre id='OQYACAywTXv'>yarn add customize-cra react-app-rewired -D<br><br>  /* package.json */<br><br>"scripts": {<br>-   "start": "react-scripts start",<br>+   "start": "react-app-rewired start",<br>-   "build": "react-scripts build",<br>+   "build": "react-app-rewired build",<br>-   "test": "react-scripts test --env=jsdom",<br>+   "test": "react-app-rewired test --env=jsdom",<br>    "eject": "react-scripts eject"<br>}<br><br>touch config-overrides.js<br><br>yarn start</pre>

<pre id='OQYACAeAzuZ'>yarn add @babel/plugin-proposal-do-expressions @babel/plugin-proposal-optional-chaining -D<br><br>// config-overrides.js<br><br>const { override, addBabelPlugins, disableEsLint } = require('customize-cra');<br><br>module.exports = override(<br>  disableEsLint(),<br>  ...addBabelPlugins(<br>    '@babel/plugin-proposal-do-expressions', <br>    '@babel/plugin-proposal-optional-chaining'<br>  )<br>);</pre>

<pre id='OQYACAmzd7t'>Folder Structure<br> <br>- /src<br>  - /assets<br>  - /components<br>  - /data<br>  - /graphql<br>  - /hooks<br>  - /images<br>  - /layouts<br>  - /styles<br>  - /utils<br>  - /views<br>  - App.js<br>  - index.js<br>  - routes.js</pre>

<h2 id='OQYACAfPxUN'>Router</h2>

<pre id='OQYACA59Un8'>yarn add react-router-dom</pre>

<pre id='OQYACAHc5YI'>// routes.js<br><br>import React from "react";<br>import { Redirect } from "react-router-dom";<br><br>import Profile from "./views/Profile";<br>import Product from "./views/Product";<br>import ProductList from "./views/ProductList";<br><br>// Layout Types<br>import { DefaultLayout, BlankLayout } from "./layouts";<br><br>export default [<br>  {<br>    path: "/",<br>    exact: true,<br>    layout: DefaultLayout,<br>    component: () =&gt; &lt;Redirect to="/products" /&gt;<br>  },<br>  {<br>    exact: true,<br>    path: "/products",<br>    layout: DefaultLayout,<br>    component: ProductList<br>  },<br>  {<br>    path: "/products/:id",<br>    layout: BlankLayout,<br>    component: Product<br>  },<br>  {<br>    path: "/profile",<br>    layout: DefaultLayout,<br>    component: Profile<br>  }<br>];</pre>

<pre id='OQYACAEzgRK'>// App.js<br><br>import { BrowserRouter as Router, Switch, Route, Link } from 'react-router-dom';<br><br>import routes from './routes';<br><br>const App = () =&gt; {<br>  return (<br>    &lt;Router&gt;<br>      &lt;div&gt;<br>        {routes.map((route, index) =&gt; (<br>          &lt;Route<br>            key={index}<br>            path={route.path}<br>            exact={route.exact}<br>            component={props =&gt; (<br>              &lt;route.layout {...props}&gt;<br>                &lt;route.component {...props} /&gt;<br>              &lt;/route.layout&gt;<br>            )}<br>          /&gt;<br>        ))}<br>      &lt;/div&gt;<br>    &lt;/Router&gt;<br>  );<br>};<br><br>export default App;</pre>

<h2 id='OQYACAWMi2Y'>Context Hook</h2>

yarn add use-immer<br/>

<br/>

<a href="https://github.com/immerjs/use-immer">https://github.com/immerjs/use-immer</a><br/>

<pre id='OQYACACricv'>// hooks/use-local-state.js<br><br>import React, { useContext, createContext } from "react";<br>import { useImmer } from "use-immer";<br><br>const defaultState = {<br>  themeColor: "white"<br>};<br><br>const LocalStateContext = createContext();<br><br>const useLocalState = () =&gt; {<br>  const [state, produce] = useContext(LocalStateContext);<br><br>  const setThemeColor = color =&gt; {<br>    produce(draft =&gt; void (draft.themeColor = color));<br>  };<br><br>  return { ...state, setThemeColor };<br>};<br><br>const LocalStateProvider = ({ children }) =&gt; {<br>  const [state, produce] = useImmer({ ...defaultState });<br>  return (<br>    &lt;LocalStateContext.Provider value={[state, produce]}&gt;<br>      {children}<br>    &lt;/LocalStateContext.Provider&gt;<br>  );<br>};<br><br>export default useLocalState;<br>export { LocalStateProvider };</pre>

<h2 id='OQYACABCrY8'>React CSS</h2>

<a href="https://emotion.sh/docs/install">https://emotion.sh/docs/install</a><br/>

<br/>

yarn add @emotion/core @emotion/styled<br/>

<br/>

yarn add @emotion/babel-preset-css-prop babel-plugin-emotion -D<br/>

<br/>

<pre id='OQYACAe5rSp'>// config-overrides.js<br><br>const { override, addBabelPresets, addBabelPlugins, disableEsLint } = require("customize-cra");<br><br>module.exports = override(<br>  disableEsLint(),<br>  ...addBabelPresets(<br>    "@emotion/babel-preset-css-prop"<br>  ),<br>  ...addBabelPlugins(<br>    "@babel/plugin-proposal-do-expressions",<br>    "@babel/plugin-proposal-optional-chaining",<br>    "emotion"<br>  )<br>);</pre>

<h2 id='OQYACAz7oaF'>Apollo</h2>

yarn add graphql apollo-boost react-apollo<br/>

<br/>

yarn add babel-plugin-import-graphql -D<br/>

<br/>

<pre id='OQYACAoVVWP'>// utils/apollo.js<br><br>import ApolloClient from 'apollo-boost';<br><br>export const createClient = () =&gt; new ApolloClient();</pre>

<pre id='OQYACATub8W'>// App.js<br><br>import { ApolloProvider } from "react-apollo";<br><br>...<br><br>const App = () =&gt; {<br>  return (<br>    &lt;ApolloProvider client={createClient()}&gt;<br>        ...<br>    &lt;/ApolloProvider&gt;<br>  );<br>};<br><br>export default App;</pre>

<pre id='OQYACAW3NWO'>// config-overrides.js<br><br>module.exports = override(<br>  ...addBabelPlugins(<br>    ...<br>    'import-graphql',<br>    ...<br>  )<br>);</pre>

<br/>

<pre id='OQYACASBv7L'>// queries.graphql<br><br>query PRODUCT_LIST {<br>  products {<br>    id<br>    name<br>    description<br>    price<br>    type<br>  }<br>}<br><br>query PRODUCT($id: ID!) {<br>  product(id: $id) {<br>    id<br>    name<br>    description<br>    price<br>    type<br>  }<br>}</pre>

<br/>

<pre id='OQYACAUAziV'>// graphql/mutations.graphql<br><br>mutation CREATE_REVIEW($review: reviewInput!) {<br>  createReview(review: $review) {<br>    id<br>  }<br>}</pre>

<br/>

yarn add @apollo/react-hooks<br/>

<pre id='OQYACACfcdL'>// views/ProductList.js<br><br>import React from 'react';<br>import { Link } from 'react-router-dom';<br>import { css } from '@emotion/core';<br><br>import { useQuery } from '@apollo/react-hooks';<br><br>import { PRODUCT_LIST } from '../graphql/queries.graphql';<br><br>const ProductList = () =&gt; {<br>  const { loading, error, data } = useQuery(PRODUCT_LIST);<br><br>  if (loading) return &lt;div&gt;Loading...&lt;/div&gt;;<br><br>  return (<br>    &lt;div css={mainStyle}&gt;<br>      &lt;div&gt;ProductList&lt;/div&gt;<br>      &lt;table&gt;<br>        &lt;tr&gt;<br>          &lt;th&gt;ID&lt;/th&gt;<br>          &lt;th&gt;Type&lt;/th&gt;<br>          &lt;th&gt;Name&lt;/th&gt;<br>          &lt;th&gt;Price&lt;/th&gt;<br>          &lt;td&gt;&lt;/td&gt;<br>        &lt;/tr&gt;<br>        {data.products.map(({ id, type, name, description, price }) =&gt; (<br>          &lt;tr&gt;<br>            &lt;td&gt;{id}&lt;/td&gt;<br>            &lt;td&gt;{type}&lt;/td&gt;<br>            &lt;td&gt;{name}&lt;/td&gt;<br>            &lt;td&gt;{price}&lt;/td&gt;<br>            &lt;td&gt;<br>              &lt;Link to={`/products/${id}`}&gt;Detail&lt;/Link&gt;<br>            &lt;/td&gt;<br>          &lt;/tr&gt;<br>        ))}<br>      &lt;/table&gt;<br>    &lt;/div&gt;<br>  );<br>};<br><br>export default ProductList;<br><br>const mainStyle = css`<br>  table, th, td {<br>    border: 1px solid black;<br>  }<br><br>  th {<br>    padding: 13px;<br>  }<br>  td {<br>    padding: 15px;<br>  }<br>`;</pre>

<br/>

<pre id='OQYACASyAOt'>// views/Product.js<br><br>import React from 'react';<br>import { css } from '@emotion/core';<br>import { useParams, useHistory } from 'react-router-dom';<br>import { useQuery } from '@apollo/react-hooks';<br><br>import { PRODUCT } from '../graphql/queries.graphql';<br><br>const Product = () =&gt; {<br>  const history = useHistory();<br>  const { id } = useParams();<br>  const { loading, error, data } = useQuery(PRODUCT, { variables: { id } });<br><br>  if (loading) return &lt;div&gt;Loading...&lt;/div&gt;;<br><br>  const { product } = data;<br><br>  return (<br>    &lt;div&gt;<br>      &lt;button onClick={() =&gt; history.push('/products')}&gt;Go Back!!&lt;/button&gt;<br>      &lt;div&gt;Product&lt;/div&gt;<br>      &lt;h3&gt;ID: {id}&lt;/h3&gt;<br>      &lt;div&gt;<br>        &lt;label&gt;Name : &lt;/label&gt;<br>        {product.name}<br>      &lt;/div&gt;<br>      &lt;div&gt;<br>        &lt;label&gt;Description : &lt;/label&gt;<br>        {product.description}<br>      &lt;/div&gt;<br>      &lt;div&gt;<br>        &lt;label&gt;Price : &lt;/label&gt;<br>        {product.price}<br>      &lt;/div&gt;<br>      {product.reviews.map(review =&gt; (<br>        &lt;div css={reviewStyle}&gt;<br>          &lt;div&gt;<br>            &lt;label&gt;Title : &lt;/label&gt;<br>            {review.title}<br>          &lt;/div&gt;<br>          &lt;div&gt;<br>            &lt;label&gt;Review : &lt;/label&gt;<br>            {review.review}<br>          &lt;/div&gt;<br>        &lt;/div&gt;<br>      ))}<br>    &lt;/div&gt;<br>  );<br>};<br><br>export default Product;<br><br>const reviewStyle = css`<br>  border: 1px solid black;<br>  padding: 10px;<br>  margin-top: 10px;<br>`;</pre>

<h2 id='OQYACATNj9y'>Create Review</h2>

yarn add react-hook-form<br/>

<br/>

<pre id='OQYACAInP7J'>// views/CreateReview.js<br><br>import React from 'react';<br>import { useMutation } from '@apollo/react-hooks';<br>import { useParams, useHistory } from 'react-router-dom';<br>import { useForm } from 'react-hook-form';<br><br>import { CREATE_REVIEW } from '../graphql/mutations.graphql';<br><br>const CreateReview = () =&gt; {<br>  const history = useHistory();<br>  const { id: productId } = useParams();<br>  const [addReview, { data }] = useMutation(CREATE_REVIEW);<br>  const { register, handleSubmit, errors } = useForm(); // initialise the hook<br><br>  const onSubmit = async data =&gt; {<br>    console.log(data);<br>    const review = { productId, ...data };<br>    await addReview({ variables: { review } });<br>    history.goBack();<br>  };<br><br>  return (<br>    &lt;div&gt;<br>      &lt;h3&gt;Product ID: {productId}&lt;/h3&gt;<br>      &lt;form onSubmit={handleSubmit(onSubmit)}&gt;<br>        &lt;div&gt;<br>          &lt;label htmlFor="title"&gt;Title&lt;/label&gt;<br>          &lt;input name="title" ref={register} /&gt;<br>        &lt;/div&gt;<br><br>        &lt;div&gt;<br>          &lt;label htmlFor="review"&gt;Review&lt;/label&gt;<br>          &lt;input name="review" ref={register} /&gt;<br>        &lt;/div&gt;<br><br>        &lt;button type="submit"&gt;Submit&lt;/button&gt;<br>      &lt;/form&gt;<br>    &lt;/div&gt;<br>  );<br>};<br><br>export default CreateReview;</pre>

<br/>

</body></html>